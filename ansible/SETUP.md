# üöÄ FastAPI Xray VPN Service - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤

## üìã –°–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤

| –°—Ç—Ä–∞–Ω–∞ | –°–µ—Ä–≤–µ—Ä | IP –∞–¥—Ä–µ—Å | –ü–∞—Ä–æ–ª—å |
|--------|--------|----------|--------|
| üá¶üá™ –û–ê–≠ | uae-server | 176.97.67.100 | soS3YxA462 |
| üáßüá∑ –ë—Ä–∞–∑–∏–ª–∏—è | brazil-server | 38.180.220.125 | Ggyj4A6UuG |
| üá©üá™ –ì–µ—Ä–º–∞–Ω–∏—è | germany-server | 37.1.199.23 | Fwq7nMJ3r9 |
| üáØüáµ –Ø–ø–æ–Ω–∏—è | japan-server | 176.97.71.56 | 7FUH9RkfsH |
| üáπüá∑ –¢—É—Ä—Ü–∏—è | turkey-server | 5.180.45.191 | YMy5iXE6ydtA |
| üá™üá∏ –ò—Å–ø–∞–Ω–∏—è | spain-server | 45.12.150.217 | I2tx1v8E5hj7 |
| üá¶üá∫ –ê–≤—Å—Ç—Ä–∞–ª–∏—è | australia-server | 45.15.185.58 | l9Z4ocxec58x |
| üá∫üá∏ –°–®–ê | usa-server | 94.131.101.213 | yV5w6rUsy9FR |

## üõ† –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Ansible

```bash
cd fastapi_xray/ansible
./scripts/install.sh
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
./scripts/manage-servers.sh -a check
```

### 3. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö

```bash
./scripts/manage-servers.sh -a deploy
```

## üìñ –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–µ—Ä—ã
./scripts/manage-servers.sh -a check

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
./scripts/manage-servers.sh -a check -l uae-server
```

### –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
```bash
# –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö
./scripts/manage-servers.sh -a deploy

# –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ
./scripts/manage-servers.sh -a deploy -l germany-server

# –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å —Ç–æ–ª—å–∫–æ Docker –∏ Nginx
./scripts/manage-servers.sh -a deploy -t docker,nginx

# –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
./scripts/manage-servers.sh -a deploy -d
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
./scripts/manage-servers.sh -a status

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
./scripts/manage-servers.sh -a restart

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
./scripts/manage-servers.sh -a logs
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–µ—Ä—ã
./scripts/manage-servers.sh -a update

# –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏
./scripts/manage-servers.sh -a backup
```

## üîß –ü—Ä—è–º—ã–µ –∫–æ–º–∞–Ω–¥—ã Ansible

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```bash
ansible-playbook playbooks/check-connectivity.yml
```

### –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
```bash
# –í—Å–µ —Å–µ—Ä–≤–µ—Ä—ã
ansible-playbook playbooks/deploy-all.yml

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
ansible-playbook playbooks/deploy-all.yml --limit uae-server

# –° —Ç–µ–≥–∞–º–∏
ansible-playbook playbooks/deploy-all.yml --tags docker,nginx
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞–º–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å Xray
ansible vpn_servers -m systemd -a "name=xray"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å FastAPI
ansible vpn_servers -m systemd -a "name=fastapi state=restarted"

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
ansible vpn_servers -m shell -a "tail -f /opt/fastapi_xray/logs/xray/access.log"
```

## üåê –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º

–ü–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å—ã –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –∞–¥—Ä–µ—Å–∞–º:

- **FastAPI API**: `http://IP:8081`
- **Xray VPN**: `IP:443`
- **Squid Proxy**: `IP:8888`
- **Nginx (HTTP)**: `http://IP`

### –ü—Ä–∏–º–µ—Ä—ã –¥–æ—Å—Ç—É–ø–∞:
- **–û–ê–≠**: `http://176.97.67.100:8081` (FastAPI), `176.97.67.100:443` (Xray)
- **–ë—Ä–∞–∑–∏–ª–∏—è**: `http://38.180.220.125:8081` (FastAPI), `38.180.220.125:443` (Xray)
- **–ì–µ—Ä–º–∞–Ω–∏—è**: `http://37.1.199.23:8081` (FastAPI), `37.1.199.23:443` (Xray)
- **–Ø–ø–æ–Ω–∏—è**: `http://176.97.71.56:8081` (FastAPI), `176.97.71.56:443` (Xray)
- **–¢—É—Ä—Ü–∏—è**: `http://5.180.45.191:8081` (FastAPI), `5.180.45.191:443` (Xray)
- **–ò—Å–ø–∞–Ω–∏—è**: `http://45.12.150.217:8081` (FastAPI), `45.12.150.217:443` (Xray)
- **–ê–≤—Å—Ç—Ä–∞–ª–∏—è**: `http://45.15.185.58:8081` (FastAPI), `45.15.185.58:443` (Xray)
- **–°–®–ê**: `http://94.131.101.213:8081` (FastAPI), `94.131.101.213:443` (Xray)

## üîê –†–∞–±–æ—Ç–∞ –±–µ–∑ –¥–æ–º–µ–Ω–æ–≤

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Ç–æ–ª—å–∫–æ –ø–æ IP –∞–¥—Ä–µ—Å–∞–º:

- **SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –æ—Ç–∫–ª—é—á–µ–Ω—ã** (—Ç–∞–∫ –∫–∞–∫ –±–µ–∑ –¥–æ–º–µ–Ω–æ–≤ –∏—Ö –ø–æ–ª—É—á–∏—Ç—å –Ω–µ–ª—å–∑—è)
- **Nginx —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ HTTP** (–ø–æ—Ä—Ç 80)
- **–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞–ø—Ä—è–º—É—é –ø–æ IP**
- **Xray VPN —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ Reality –ø—Ä–æ—Ç–æ–∫–æ–ª—É** (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç SSL)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```
ansible/
‚îú‚îÄ‚îÄ inventory/hosts.yml          # –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ host_vars/                   # –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ uae-server.yml
‚îÇ   ‚îú‚îÄ‚îÄ brazil-server.yml
‚îÇ   ‚îú‚îÄ‚îÄ germany-server.yml
‚îÇ   ‚îú‚îÄ‚îÄ japan-server.yml
‚îÇ   ‚îú‚îÄ‚îÄ turkey-server.yml
‚îÇ   ‚îú‚îÄ‚îÄ spain-server.yml
‚îÇ   ‚îú‚îÄ‚îÄ australia-server.yml
‚îÇ   ‚îî‚îÄ‚îÄ usa-server.yml
‚îú‚îÄ‚îÄ group_vars/                  # –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ all.yml
‚îÇ   ‚îî‚îÄ‚îÄ vpn_servers.yml
‚îú‚îÄ‚îÄ playbooks/                   # Playbook'–∏ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ deploy-all.yml
‚îÇ   ‚îú‚îÄ‚îÄ check-connectivity.yml
‚îÇ   ‚îú‚îÄ‚îÄ update.yml
‚îÇ   ‚îú‚îÄ‚îÄ backup.yml
‚îÇ   ‚îî‚îÄ‚îÄ restore.yml
‚îî‚îÄ‚îÄ scripts/                     # –°–∫—Ä–∏–ø—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    ‚îú‚îÄ‚îÄ install.sh
    ‚îú‚îÄ‚îÄ deploy.sh
    ‚îî‚îÄ‚îÄ manage-servers.sh
```

## üö® –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ü–∞—Ä–æ–ª–∏**: –í—Å–µ –ø–∞—Ä–æ–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ inventory —Ñ–∞–π–ª–µ. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SSH –∫–ª—é—á–∏ –≤–º–µ—Å—Ç–æ –ø–∞—Ä–æ–ª–µ–π.

2. **–ë–µ–∑ –¥–æ–º–µ–Ω–æ–≤**: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ IP –∞–¥—Ä–µ—Å–∞–º, SSL –æ—Ç–∫–ª—é—á–µ–Ω.

3. **HTTP —Ç–æ–ª—å–∫–æ**: Nginx —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ HTTP (–ø–æ—Ä—Ç 80), HTTPS –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.

4. **Firewall**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è UFW —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –¥–ª—è –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–æ—Ä—Ç–æ–≤.

5. **–õ–æ–≥–∏**: –í—Å–µ –ª–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `/opt/fastapi_xray/logs/` –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–µ—Ä–µ.

6. **Xray Reality**: VPN —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ Reality –ø—Ä–æ—Ç–æ–∫–æ–ª—É, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤.

## üîç Troubleshooting

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
ssh root@176.97.67.100

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ Ansible
ansible uae-server -m ping
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ä–≤–∏—Å–∞–º–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
systemctl status xray fastapi squid nginx

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
journalctl -u xray -f
docker logs fastapi
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ä–≤–∏—Å–∞–º–∏
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
systemctl status xray fastapi squid nginx

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
systemctl restart xray fastapi squid nginx
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ DNS –∑–∞–ø–∏—Å–µ–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç–æ–≤
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

---

**–ì–æ—Ç–æ–≤–æ!** üéâ –¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ VPN —Å–µ—Ä–≤–µ—Ä–æ–≤ –≤ 8 —Å—Ç—Ä–∞–Ω–∞—Ö –º–∏—Ä–∞.
